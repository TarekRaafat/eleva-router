{"version":3,"file":"eleva-router.umd.js","sources":["../src/index.js"],"sourcesContent":["/**\n * @class Router\n * @classdesc A Router Plugin for Eleva.js with Multiple Routing Modes\n *\n * This plugin provides client-side routing functionality for Eleva.js applications.\n * It supports hash-based (e.g. \"#pageName\"), query-based (e.g. \"?page=pageName\"),\n * and history-based (e.g. \"/pageName\") routing. The routing mode is configurable via\n * the plugin options.\n *\n * In addition to injecting route information (current path, query parameters,\n * and full URL) directly into the component's setup context as `route`, this plugin\n * also injects a `navigate` function so developers can programmatically navigate from within components.\n *\n * @param {Object} eleva - The Eleva instance.\n * @param {Object} options - Router configuration options.\n * @param {HTMLElement} options.container - The DOM element where routed components will be mounted.\n * @param {string} [options.mode=\"hash\"] - The routing mode (\"hash\", \"query\", or \"history\").\n * @param {Array<Object>} options.routes - An array of route objects. Each route object should have:\n *   - {string} path - The URL path (e.g. \"/\" or \"/about\").\n *   - {string|Object} component - The component name (if registered globally) or a component definition.\n *   - {Object} [props] - Additional props to pass to the component.\n * @param {Object} [options.defaultRoute] - A default route object used when no route matches.\n */\nclass Router {\n  constructor(eleva, options = {}) {\n    this.eleva = eleva;\n    this.container = options.container;\n    if (!this.container) {\n      throw new Error(\"Router requires a container DOM element in options.\");\n    }\n    this.routes = options.routes || [];\n    this.mode = options.mode || \"hash\"; // \"hash\", \"query\", or \"history\"\n    this.defaultRoute = options.defaultRoute || null;\n  }\n\n  /**\n   * Starts the router by setting up event listeners and resolving the initial route.\n   * @returns {void}\n   */\n  start() {\n    if (this.mode === \"hash\") {\n      window.addEventListener(\"hashchange\", () => this.routeChanged());\n    } else if (this.mode === \"query\" || this.mode === \"history\") {\n      window.addEventListener(\"popstate\", () => this.routeChanged());\n    } else {\n      throw new Error(`Invalid routing mode: ${this.mode}`);\n    }\n    // Resolve the initial route.\n    this.routeChanged();\n  }\n\n  /**\n   * Called when the route changes. Extracts the current route based on the routing mode,\n   * parses the URL query, and mounts the corresponding component. Injects route data and\n   * a navigation function directly into the component's setup context.\n   * @returns {void}\n   */\n  routeChanged() {\n    let path, queryString, fullUrl;\n    if (this.mode === \"hash\") {\n      fullUrl = window.location.href;\n      let hash = window.location.hash.slice(1) || \"\";\n      [path, queryString] = hash.split(\"?\");\n      // If path is empty, default to \"/\"\n      path = path || \"/\";\n    } else if (this.mode === \"query\") {\n      fullUrl = window.location.href;\n      const search = window.location.search; // e.g. ?page=about&foo=bar\n      const urlParams = new URLSearchParams(search);\n      path = urlParams.get(\"page\") || \"\";\n      urlParams.delete(\"page\");\n      queryString = urlParams.toString();\n      path = path || \"/\";\n    } else if (this.mode === \"history\") {\n      fullUrl = window.location.href;\n      path = window.location.pathname || \"/\";\n      queryString = window.location.search\n        ? window.location.search.slice(1)\n        : \"\";\n    } else {\n      throw new Error(\"Invalid router mode: \" + this.mode);\n    }\n    // Normalize the path: Ensure it starts with '/'\n    if (path.charAt(0) !== \"/\") {\n      path = \"/\" + path;\n    }\n    const query = this.parseQuery(queryString);\n    // Try to find a matching route for the current path.\n    let route = this.matchRoute(path);\n    // Use defaultRoute if no matching route is found.\n    if (!route && this.defaultRoute) {\n      route = this.defaultRoute;\n    }\n    if (route) {\n      const wrappedComponent = this.wrapComponentWithRoute(route.component, {\n        path,\n        query,\n        fullUrl,\n      });\n      const props = route.props || {};\n      // For all modes, clear the container before mounting the new route.\n      this.container.innerHTML = \"\";\n      this.eleva.mount(this.container, wrappedComponent, props);\n    }\n  }\n\n  /**\n   * Parses a query string into an object.\n   * @param {string} queryString - The query string portion of a URL.\n   * @returns {Object} An object containing key-value pairs for query parameters.\n   */\n  parseQuery(queryString) {\n    const query = {};\n    if (!queryString) return query;\n    queryString.split(\"&\").forEach((pair) => {\n      const [key, value] = pair.split(\"=\");\n      if (key) {\n        query[decodeURIComponent(key)] = value ? decodeURIComponent(value) : \"\";\n      }\n    });\n    return query;\n  }\n\n  /**\n   * Finds a matching route for the specified path.\n   * @param {string} path - The current path extracted from the URL.\n   * @returns {Object|undefined} The matching route object, or undefined if no match is found.\n   */\n  matchRoute(path) {\n    return this.routes.find((route) => route.path === path);\n  }\n\n  /**\n   * Programmatically navigates to the specified route.\n   * Updates the URL based on the routing mode and triggers route resolution.\n   * @param {string} path - The target route path.\n   * @returns {void}\n   */\n  navigate(path) {\n    if (this.mode === \"hash\") {\n      // In hash mode, if navigating to home (\"/\"), remove the hash entirely.\n      if (path === \"/\" || path === \"\") {\n        // Remove the hash entirely using replaceState and update the view.\n        history.replaceState(\n          null,\n          \"\",\n          window.location.pathname + window.location.search\n        );\n        this.routeChanged();\n      } else {\n        window.location.hash = path;\n      }\n    } else if (this.mode === \"query\") {\n      const urlParams = new URLSearchParams(window.location.search);\n      if (path === \"/\" || path === \"\") {\n        urlParams.delete(\"page\");\n      } else {\n        urlParams.set(\"page\", path);\n      }\n      const newQuery = urlParams.toString();\n      const newUrl =\n        window.location.pathname + (newQuery ? \"?\" + newQuery : \"\");\n      history.pushState({}, \"\", newUrl);\n      this.routeChanged();\n    } else if (this.mode === \"history\") {\n      history.pushState({}, \"\", path);\n      this.routeChanged();\n    }\n  }\n\n  /**\n   * Adds a new route to the router.\n   * @param {Object} route - The route object to add.\n   * @returns {void}\n   */\n  addRoute(route) {\n    this.routes.push(route);\n  }\n\n  /**\n   * Wraps a component definition so that its setup function receives the route information\n   * and the navigate function directly in the context.\n   * @param {string|Object} comp - The component name (if registered globally) or component definition.\n   * @param {Object} routeInfo - An object containing route information (path, query, fullUrl).\n   * @returns {Object} A new component definition with an augmented setup function.\n   */\n  wrapComponentWithRoute(comp, routeInfo) {\n    let definition = comp;\n    if (typeof comp === \"string\") {\n      definition = this.eleva._components[comp];\n      if (!definition) {\n        throw new Error(`Component \"${comp}\" not registered.`);\n      }\n    }\n    // Create a shallow copy of the component definition.\n    const wrapped = { ...definition };\n    const originalSetup = wrapped.setup;\n    wrapped.setup = (ctx) => {\n      ctx.route = routeInfo;\n      ctx.navigate = this.navigate.bind(this);\n      // Inject route information and navigation function into the context.\n      return originalSetup ? originalSetup(ctx) : {};\n    };\n    return wrapped;\n  }\n}\n\n/**\n * @typedef {Object} RouteDefinition\n * @property {string} path - The URL path (e.g., \"/\" or \"/about\").\n * @property {string|Object} component - The component name (if registered globally) or a component definition.\n * @property {Object} [props] - Additional properties to pass to the routed component.\n */\n\n/**\n * @typedef {Object} RouterOptions\n * @property {HTMLElement} container - The DOM element where routed components will be mounted.\n * @property {string} [mode=\"hash\"] - The routing mode: \"hash\", \"query\", or \"history\".\n * @property {Array<RouteDefinition>} routes - An array of route definitions.\n * @property {RouteDefinition} [defaultRoute] - A default route object to use when no route matches.\n */\n\n/**\n * @namespace ElevaRouter\n * @description ElevaRouter is the official router plugin for Eleva.js.\n *\n * It provides client-side routing\n * functionality with support for multiple routing modes, automatic component registration, and route\n * information injection into the setup context.\n *\n * Installs the ElevaRouter plugin into an Eleva.js instance.\n * Automatically registers routed components if provided as definitions.\n *\n * @param {Object} eleva - The Eleva instance.\n * @param {RouterOptions} options - Router configuration options.\n * @returns {void}\n */\nconst ElevaRouter = {\n  install(eleva, options = {}) {\n    // Automatically register routed components if provided as definitions.\n    const routes = options.routes || [];\n    let autoRegCounter = 0;\n    routes.forEach((route) => {\n      if (typeof route.component === \"object\") {\n        let compName = route.component.name;\n        if (!compName) {\n          compName = \"AutoRegComponent_\" + autoRegCounter++;\n        }\n        eleva.component(compName, route.component);\n        route.component = compName;\n      }\n    });\n    const router = new Router(eleva, options);\n    eleva.router = router;\n    router.start();\n  },\n};\n\nexport default ElevaRouter;\n"],"names":["Router","constructor","eleva","options","container","Error","routes","mode","defaultRoute","start","window","addEventListener","routeChanged","path","queryString","fullUrl","location","href","hash","slice","split","search","urlParams","URLSearchParams","get","delete","toString","pathname","charAt","query","parseQuery","route","matchRoute","wrappedComponent","wrapComponentWithRoute","component","props","innerHTML","mount","forEach","pair","key","value","decodeURIComponent","find","navigate","history","replaceState","set","newQuery","newUrl","pushState","addRoute","push","comp","routeInfo","definition","_components","wrapped","originalSetup","setup","ctx","bind","ElevaRouter","install","autoRegCounter","compName","name","router"],"mappings":";;;;;;;EAAA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,MAAMA,MAAM,CAAC;EACXC,EAAAA,WAAWA,CAACC,KAAK,EAAEC,OAAO,GAAG,EAAE,EAAE;MAC/B,IAAI,CAACD,KAAK,GAAGA,KAAK;EAClB,IAAA,IAAI,CAACE,SAAS,GAAGD,OAAO,CAACC,SAAS;EAClC,IAAA,IAAI,CAAC,IAAI,CAACA,SAAS,EAAE;EACnB,MAAA,MAAM,IAAIC,KAAK,CAAC,qDAAqD,CAAC;EACxE;EACA,IAAA,IAAI,CAACC,MAAM,GAAGH,OAAO,CAACG,MAAM,IAAI,EAAE;MAClC,IAAI,CAACC,IAAI,GAAGJ,OAAO,CAACI,IAAI,IAAI,MAAM,CAAC;EACnC,IAAA,IAAI,CAACC,YAAY,GAAGL,OAAO,CAACK,YAAY,IAAI,IAAI;EAClD;;EAEA;EACF;EACA;EACA;EACEC,EAAAA,KAAKA,GAAG;EACN,IAAA,IAAI,IAAI,CAACF,IAAI,KAAK,MAAM,EAAE;QACxBG,MAAM,CAACC,gBAAgB,CAAC,YAAY,EAAE,MAAM,IAAI,CAACC,YAAY,EAAE,CAAC;EAClE,KAAC,MAAM,IAAI,IAAI,CAACL,IAAI,KAAK,OAAO,IAAI,IAAI,CAACA,IAAI,KAAK,SAAS,EAAE;QAC3DG,MAAM,CAACC,gBAAgB,CAAC,UAAU,EAAE,MAAM,IAAI,CAACC,YAAY,EAAE,CAAC;EAChE,KAAC,MAAM;QACL,MAAM,IAAIP,KAAK,CAAC,CAAA,sBAAA,EAAyB,IAAI,CAACE,IAAI,EAAE,CAAC;EACvD;EACA;MACA,IAAI,CAACK,YAAY,EAAE;EACrB;;EAEA;EACF;EACA;EACA;EACA;EACA;EACEA,EAAAA,YAAYA,GAAG;EACb,IAAA,IAAIC,IAAI,EAAEC,WAAW,EAAEC,OAAO;EAC9B,IAAA,IAAI,IAAI,CAACR,IAAI,KAAK,MAAM,EAAE;EACxBQ,MAAAA,OAAO,GAAGL,MAAM,CAACM,QAAQ,CAACC,IAAI;EAC9B,MAAA,IAAIC,IAAI,GAAGR,MAAM,CAACM,QAAQ,CAACE,IAAI,CAACC,KAAK,CAAC,CAAC,CAAC,IAAI,EAAE;QAC9C,CAACN,IAAI,EAAEC,WAAW,CAAC,GAAGI,IAAI,CAACE,KAAK,CAAC,GAAG,CAAC;EACrC;QACAP,IAAI,GAAGA,IAAI,IAAI,GAAG;EACpB,KAAC,MAAM,IAAI,IAAI,CAACN,IAAI,KAAK,OAAO,EAAE;EAChCQ,MAAAA,OAAO,GAAGL,MAAM,CAACM,QAAQ,CAACC,IAAI;QAC9B,MAAMI,MAAM,GAAGX,MAAM,CAACM,QAAQ,CAACK,MAAM,CAAC;EACtC,MAAA,MAAMC,SAAS,GAAG,IAAIC,eAAe,CAACF,MAAM,CAAC;QAC7CR,IAAI,GAAGS,SAAS,CAACE,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE;EAClCF,MAAAA,SAAS,CAACG,MAAM,CAAC,MAAM,CAAC;EACxBX,MAAAA,WAAW,GAAGQ,SAAS,CAACI,QAAQ,EAAE;QAClCb,IAAI,GAAGA,IAAI,IAAI,GAAG;EACpB,KAAC,MAAM,IAAI,IAAI,CAACN,IAAI,KAAK,SAAS,EAAE;EAClCQ,MAAAA,OAAO,GAAGL,MAAM,CAACM,QAAQ,CAACC,IAAI;EAC9BJ,MAAAA,IAAI,GAAGH,MAAM,CAACM,QAAQ,CAACW,QAAQ,IAAI,GAAG;EACtCb,MAAAA,WAAW,GAAGJ,MAAM,CAACM,QAAQ,CAACK,MAAM,GAChCX,MAAM,CAACM,QAAQ,CAACK,MAAM,CAACF,KAAK,CAAC,CAAC,CAAC,GAC/B,EAAE;EACR,KAAC,MAAM;QACL,MAAM,IAAId,KAAK,CAAC,uBAAuB,GAAG,IAAI,CAACE,IAAI,CAAC;EACtD;EACA;MACA,IAAIM,IAAI,CAACe,MAAM,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;QAC1Bf,IAAI,GAAG,GAAG,GAAGA,IAAI;EACnB;EACA,IAAA,MAAMgB,KAAK,GAAG,IAAI,CAACC,UAAU,CAAChB,WAAW,CAAC;EAC1C;EACA,IAAA,IAAIiB,KAAK,GAAG,IAAI,CAACC,UAAU,CAACnB,IAAI,CAAC;EACjC;EACA,IAAA,IAAI,CAACkB,KAAK,IAAI,IAAI,CAACvB,YAAY,EAAE;QAC/BuB,KAAK,GAAG,IAAI,CAACvB,YAAY;EAC3B;EACA,IAAA,IAAIuB,KAAK,EAAE;QACT,MAAME,gBAAgB,GAAG,IAAI,CAACC,sBAAsB,CAACH,KAAK,CAACI,SAAS,EAAE;UACpEtB,IAAI;UACJgB,KAAK;EACLd,QAAAA;EACF,OAAC,CAAC;EACF,MAAA,MAAMqB,KAAK,GAAGL,KAAK,CAACK,KAAK,IAAI,EAAE;EAC/B;EACA,MAAA,IAAI,CAAChC,SAAS,CAACiC,SAAS,GAAG,EAAE;EAC7B,MAAA,IAAI,CAACnC,KAAK,CAACoC,KAAK,CAAC,IAAI,CAAClC,SAAS,EAAE6B,gBAAgB,EAAEG,KAAK,CAAC;EAC3D;EACF;;EAEA;EACF;EACA;EACA;EACA;IACEN,UAAUA,CAAChB,WAAW,EAAE;MACtB,MAAMe,KAAK,GAAG,EAAE;EAChB,IAAA,IAAI,CAACf,WAAW,EAAE,OAAOe,KAAK;MAC9Bf,WAAW,CAACM,KAAK,CAAC,GAAG,CAAC,CAACmB,OAAO,CAAEC,IAAI,IAAK;QACvC,MAAM,CAACC,GAAG,EAAEC,KAAK,CAAC,GAAGF,IAAI,CAACpB,KAAK,CAAC,GAAG,CAAC;EACpC,MAAA,IAAIqB,GAAG,EAAE;EACPZ,QAAAA,KAAK,CAACc,kBAAkB,CAACF,GAAG,CAAC,CAAC,GAAGC,KAAK,GAAGC,kBAAkB,CAACD,KAAK,CAAC,GAAG,EAAE;EACzE;EACF,KAAC,CAAC;EACF,IAAA,OAAOb,KAAK;EACd;;EAEA;EACF;EACA;EACA;EACA;IACEG,UAAUA,CAACnB,IAAI,EAAE;EACf,IAAA,OAAO,IAAI,CAACP,MAAM,CAACsC,IAAI,CAAEb,KAAK,IAAKA,KAAK,CAAClB,IAAI,KAAKA,IAAI,CAAC;EACzD;;EAEA;EACF;EACA;EACA;EACA;EACA;IACEgC,QAAQA,CAAChC,IAAI,EAAE;EACb,IAAA,IAAI,IAAI,CAACN,IAAI,KAAK,MAAM,EAAE;EACxB;EACA,MAAA,IAAIM,IAAI,KAAK,GAAG,IAAIA,IAAI,KAAK,EAAE,EAAE;EAC/B;EACAiC,QAAAA,OAAO,CAACC,YAAY,CAClB,IAAI,EACJ,EAAE,EACFrC,MAAM,CAACM,QAAQ,CAACW,QAAQ,GAAGjB,MAAM,CAACM,QAAQ,CAACK,MAC7C,CAAC;UACD,IAAI,CAACT,YAAY,EAAE;EACrB,OAAC,MAAM;EACLF,QAAAA,MAAM,CAACM,QAAQ,CAACE,IAAI,GAAGL,IAAI;EAC7B;EACF,KAAC,MAAM,IAAI,IAAI,CAACN,IAAI,KAAK,OAAO,EAAE;QAChC,MAAMe,SAAS,GAAG,IAAIC,eAAe,CAACb,MAAM,CAACM,QAAQ,CAACK,MAAM,CAAC;EAC7D,MAAA,IAAIR,IAAI,KAAK,GAAG,IAAIA,IAAI,KAAK,EAAE,EAAE;EAC/BS,QAAAA,SAAS,CAACG,MAAM,CAAC,MAAM,CAAC;EAC1B,OAAC,MAAM;EACLH,QAAAA,SAAS,CAAC0B,GAAG,CAAC,MAAM,EAAEnC,IAAI,CAAC;EAC7B;EACA,MAAA,MAAMoC,QAAQ,GAAG3B,SAAS,CAACI,QAAQ,EAAE;EACrC,MAAA,MAAMwB,MAAM,GACVxC,MAAM,CAACM,QAAQ,CAACW,QAAQ,IAAIsB,QAAQ,GAAG,GAAG,GAAGA,QAAQ,GAAG,EAAE,CAAC;QAC7DH,OAAO,CAACK,SAAS,CAAC,EAAE,EAAE,EAAE,EAAED,MAAM,CAAC;QACjC,IAAI,CAACtC,YAAY,EAAE;EACrB,KAAC,MAAM,IAAI,IAAI,CAACL,IAAI,KAAK,SAAS,EAAE;QAClCuC,OAAO,CAACK,SAAS,CAAC,EAAE,EAAE,EAAE,EAAEtC,IAAI,CAAC;QAC/B,IAAI,CAACD,YAAY,EAAE;EACrB;EACF;;EAEA;EACF;EACA;EACA;EACA;IACEwC,QAAQA,CAACrB,KAAK,EAAE;EACd,IAAA,IAAI,CAACzB,MAAM,CAAC+C,IAAI,CAACtB,KAAK,CAAC;EACzB;;EAEA;EACF;EACA;EACA;EACA;EACA;EACA;EACEG,EAAAA,sBAAsBA,CAACoB,IAAI,EAAEC,SAAS,EAAE;MACtC,IAAIC,UAAU,GAAGF,IAAI;EACrB,IAAA,IAAI,OAAOA,IAAI,KAAK,QAAQ,EAAE;QAC5BE,UAAU,GAAG,IAAI,CAACtD,KAAK,CAACuD,WAAW,CAACH,IAAI,CAAC;QACzC,IAAI,CAACE,UAAU,EAAE;EACf,QAAA,MAAM,IAAInD,KAAK,CAAC,CAAciD,WAAAA,EAAAA,IAAI,mBAAmB,CAAC;EACxD;EACF;EACA;EACA,IAAA,MAAMI,OAAO,GAAG;QAAE,GAAGF;OAAY;EACjC,IAAA,MAAMG,aAAa,GAAGD,OAAO,CAACE,KAAK;EACnCF,IAAAA,OAAO,CAACE,KAAK,GAAIC,GAAG,IAAK;QACvBA,GAAG,CAAC9B,KAAK,GAAGwB,SAAS;QACrBM,GAAG,CAAChB,QAAQ,GAAG,IAAI,CAACA,QAAQ,CAACiB,IAAI,CAAC,IAAI,CAAC;EACvC;QACA,OAAOH,aAAa,GAAGA,aAAa,CAACE,GAAG,CAAC,GAAG,EAAE;OAC/C;EACD,IAAA,OAAOH,OAAO;EAChB;EACF;;EAEA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;AACA,QAAMK,WAAW,GAAG;EAClBC,EAAAA,OAAOA,CAAC9D,KAAK,EAAEC,OAAO,GAAG,EAAE,EAAE;EAC3B;EACA,IAAA,MAAMG,MAAM,GAAGH,OAAO,CAACG,MAAM,IAAI,EAAE;MACnC,IAAI2D,cAAc,GAAG,CAAC;EACtB3D,IAAAA,MAAM,CAACiC,OAAO,CAAER,KAAK,IAAK;EACxB,MAAA,IAAI,OAAOA,KAAK,CAACI,SAAS,KAAK,QAAQ,EAAE;EACvC,QAAA,IAAI+B,QAAQ,GAAGnC,KAAK,CAACI,SAAS,CAACgC,IAAI;UACnC,IAAI,CAACD,QAAQ,EAAE;EACbA,UAAAA,QAAQ,GAAG,mBAAmB,GAAGD,cAAc,EAAE;EACnD;UACA/D,KAAK,CAACiC,SAAS,CAAC+B,QAAQ,EAAEnC,KAAK,CAACI,SAAS,CAAC;UAC1CJ,KAAK,CAACI,SAAS,GAAG+B,QAAQ;EAC5B;EACF,KAAC,CAAC;MACF,MAAME,MAAM,GAAG,IAAIpE,MAAM,CAACE,KAAK,EAAEC,OAAO,CAAC;MACzCD,KAAK,CAACkE,MAAM,GAAGA,MAAM;MACrBA,MAAM,CAAC3D,KAAK,EAAE;EAChB;EACF;;;;;;;;"}